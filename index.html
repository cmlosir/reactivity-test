<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metals Reactivity Challenge</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --bg: #f4f7f6;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 1100px; width: 100%; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; }
        
        .lang-switch { position: absolute; top: 20px; right: 20px; }
        h1 { color: var(--primary); text-align: center; margin-bottom: 30px; }

        .lab-bench { display: flex; justify-content: space-around; align-items: flex-end; height: 350px; margin: 40px 0; border-bottom: 10px solid #7f8c8d; }
        .tube-unit { display: flex; flex-direction: column; align-items: center; position: relative; width: 200px; }

        .splint { position: absolute; top: -30px; right: -80px; width: 80px; height: 6px; background: #8B4513; transform: rotate(-30deg); display: none; z-index: 10; transition: all 0.5s ease; }
        .flame { position: absolute; left: -10px; top: -10px; width: 15px; height: 15px; background: #ff9d00; border-radius: 50% 50% 20% 50%; transform: rotate(-45deg); box-shadow: 0 0 10px red; animation: flicker 0.1s infinite alternate; }
        @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.2); } }
        .pop-effect { position: absolute; top: -50px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; background: radial-gradient(circle, #fff, #ff9d00, transparent); border-radius: 50%; display: none; z-index: 11; text-align: center; line-height: 60px; font-weight: bold; color: white; }

        .thermometer { width: 12px; height: 150px; background: #ddd; border-radius: 10px; position: relative; border: 2px solid #95a5a6; margin-right: 10px; }
        .mercury { width: 100%; background: var(--accent); position: absolute; bottom: 0; height: 25%; transition: height 1.5s; border-radius: 10px; }
        .temp-val { font-size: 14px; position: absolute; top: -25px; width: 50px; text-align: center; font-weight: bold; }
        
        .test-tube { width: 65px; height: 200px; border: 3px solid #7f8c8d; border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; position: relative; background: rgba(255,255,255,0.4); overflow: visible; }
        .liquid { position: absolute; bottom: 0; width: 100%; height: 45%; background: rgba(52, 152, 219, 0.2); transition: 0.5s; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .acid { background: rgba(155, 89, 182, 0.2); }

        .metal { width: 22px; height: 22px; position: absolute; bottom: 8px; left: 21px; display: none; background: #7f8c8d; }
        .bubbles { position: absolute; bottom: 10px; width: 100%; height: 150px; display: none; pointer-events: none; }
        .bubble { position: absolute; background: white; border-radius: 50%; animation: rise linear infinite; opacity: 0.6; }
        @keyframes rise { from { bottom: 0; } to { bottom: 100%; opacity: 0; } }

        .notebook { margin-top: 30px; background: #fffde7; padding: 20px; border-radius: 15px; border: 1px solid #ffe082; width: 100%; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #d7ccc8; padding: 12px; text-align: center; }

        .challenge-zone { margin-top: 30px; padding: 25px; background: #e8f5e9; border-radius: 15px; text-align: center; }
        .selection-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .box { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-test { background: #e67e22; color: white; width: 100%; margin-top: 20px; font-size: 1.1em; }
        .btn-submit { background: #2e7d32; color: white; margin-top: 20px; padding: 15px 40px; }
        .btn-submit:hover { background: #1b5e20; }

        #status { margin-top: 20px; padding: 15px; font-weight: bold; text-align: center; border-radius: 8px; min-height: 20px; }
        .status-wrong { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .status-correct { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-switch">
        <button class="btn" onclick="toggleLang()" style="background:#fff; border:1px solid #ccc;">English / ‰∏≠Êñá</button>
    </div>

    <h1 id="txt-title">Metals Reactivity Challenge (Unknown Metals)</h1>

    <div style="text-align: center; margin-bottom: 20px;">
        <strong id="txt-select-reagent">Select Reagent:</strong>
        <select id="reagent" onchange="resetLab(false)" style="padding: 5px;">
            <option value="water" id="opt-water">Distilled Water (H2O)</option>
            <option value="acid" id="opt-acid">Dilute HCl</option>
        </select>
        <button class="btn" style="background:#bdc3c7; margin-left:10px;" onclick="resetLab(true)" id="btn-restart">üîÑ Restart (Randomize)</button>
    </div>

    <div class="lab-bench">
        <script>
            ['A', 'B', 'C'].forEach(id => {
                document.write(`
                    <div class="tube-unit">
                        <div id="pop${id}" class="pop-effect">POP!</div>
                        <div id="splint${id}" class="splint"><div class="flame"></div></div>
                        <div class="temp-val" id="temp${id}">25¬∞C</div>
                        <div style="display: flex; align-items: flex-end;">
                            <div class="thermometer"><div class="mercury" id="merc${id}"></div></div>
                            <div class="test-tube">
                                <div class="liquid" id="liq${id}"></div>
                                <div class="metal" id="m${id}"></div>
                                <div class="bubbles" id="b${id}"></div>
                            </div>
                        </div>
                        <strong style="margin-top:10px;">Unknown ${id}</strong>
                        <button class="btn btn-add" onclick="addMetal('${id}')" id="btn-add-${id}">Add</button>
                    </div>
                `);
            });
        </script>
    </div>

    <button class="btn btn-test" onclick="startPopTest()" id="btn-pop">üî• Test for Gas (Pop Test)</button>

    <div class="notebook">
        <h3 id="txt-notebook">üìî Observation Table</h3>
        <table>
            <thead>
                <tr>
                    <th id="th-metal">Metal</th>
                    <th id="th-bubbles">Bubbling Observed?</th>
                    <th id="th-heat">Temperature Increase?</th>
                    <th id="th-pop">Pop sound test?</th>
                </tr>
            </thead>
            <tbody>
                <script>
                    ['A', 'B', 'C'].forEach(id => {
                        document.write(`
                            <tr>
                                <td>Unknown ${id}</td>
                                <td>
                                    <label><input type="radio" name="bub${id}" value="yes"> Yes</label>
                                    <label><input type="radio" name="bub${id}" value="no"> No</label>
                                </td>
                                <td>
                                    <label><input type="radio" name="heat${id}" value="yes"> Yes</label>
                                    <label><input type="radio" name="heat${id}" value="no"> No</label>
                                </td>
                                <td>
                                    <label><input type="radio" name="popTest${id}" value="yes"> Yes</label>
                                    <label><input type="radio" name="popTest${id}" value="no"> No</label>
                                </td>
                            </tr>
                        `);
                    });
                </script>
            </tbody>
        </table>
    </div>

    <div class="challenge-zone">
        <h3 id="txt-challenge">üèÜ Final Conclusion</h3>
        <div class="selection-grid">
            <div class="box">
                <p id="txt-order">Reactivity Order (1 = Highest):</p>
                1: <select id="rank1" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select><br>
                2: <select id="rank2" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select><br>
                3: <select id="rank3" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select>
            </div>
            <div class="box">
                <p id="txt-identity">Identify the Metals:</p>
                A: <select id="idA" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select><br>
                B: <select id="idB" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select><br>
                C: <select id="idC" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select>
            </div>
        </div>
        <button class="btn btn-submit" onclick="checkAnswers()" id="btn-submit">Submit Result</button>
    </div>
    
    <div id="status"></div>
</div>

<script>
    let lang = 'en'; 
    let metalMapping = { A: "", B: "", C: "" };
    let activeMetals = { A: false, B: false, C: false };

    const i18n = {
        en: {
            title: "Metals Reactivity Challenge (Unknown Metals)",
            selectReagent: "Select Reagent:",
            water: "Distilled Water (H2O)",
            acid: "Dilute HCl",
            notebook: "üìî Observation Table",
            thMetal: "Metal", thBub: "Bubbling Observed?", thHeat: "Temperature Increase?", thPop: "Pop sound test?",
            add: "Add",
            challenge: "üèÜ Final Conclusion",
            order: "Reactivity Order (1 = Highest):",
            identity: "Identify the Metals:",
            submit: "Submit Result",
            popMsg: "*POP!* Hydrogen gas detected!",
            wrong: "‚ùå Incorrect! Observe the bubbles, heat, and pop test carefully and try again.",
            correct: "‚úÖ Well done! You have correctly identified all metals and their order!",
            ready: "Add metals to the tubes to start your observation.",
            ca: "Calcium", mg: "Magnesium", cu: "Copper"
        },
        zh: {
            title: "Êú™Áü•ÈáëÂ±¨ÂèçÊáâÊÄßÊåëÊà∞",
            selectReagent: "ÈÅ∏ÊìáË©¶ÂäëÔºö",
            water: "Ëí∏È§æÊ∞¥ (H2O)",
            acid: "Á®ÄÈáãÈπΩÈÖ∏ (HCl)",
            notebook: "üìî ËßÄÂØüÁ¥ÄÈåÑË°®",
            thMetal: "ÈáëÂ±¨", thBub: "Áî¢ÁîüÊ∞£Ê≥°?", thHeat: "ÊîæÁÜ±/Ê∫´Â∫¶‰∏äÂçá?", thPop: "ÁàÜÈ≥¥ËÅ≤Ê∏¨Ë©¶?",
            add: "Âä†ÂÖ•",
            challenge: "üèÜ ÊúÄÁµÇÂà§Êñ∑",
            order: "ÂèçÊáâÊÄßÈ†ÜÂ∫è (1 ÁÇ∫ÊúÄÂº∑)Ôºö",
            identity: "Ë≠òÂà•ÈáëÂ±¨Ë∫´‰ªΩÔºö",
            submit: "Êèê‰∫§ÁµêÊûú",
            popMsg: "*POP!* Ê™¢Ê∏¨Âà∞Ê∞´Ê∞£ÔºÅ",
            wrong: "‚ùå Á≠îÊ°àÈåØË™§ÔºÅË´ã‰ªîÁ¥∞ËßÄÂØüÊ∞£Ê≥°„ÄÅÊîæÁÜ±ÂèäÁàÜÈ≥¥ËÅ≤Ê∏¨Ë©¶‰∏¶ÈáçÊñ∞ÂòóË©¶„ÄÇ",
            correct: "‚úÖ Â§™Ê£í‰∫ÜÔºÅ‰Ω†Ê≠£Á¢∫Âú∞Ë≠òÂà•‰∫ÜÊâÄÊúâÈáëÂ±¨ÂíåÂèçÊáâÈ†ÜÂ∫èÔºÅ",
            ready: "Ë´ãÂ∞áÈáëÂ±¨ÊîæÂÖ•Ë©¶ÁÆ°ÈñãÂßãËßÄÂØü„ÄÇ",
            ca: "Èà£ (Calcium)", mg: "ÈéÇ (Magnesium)", cu: "ÈäÖ (Copper)"
        }
    };

    function toggleLang() {
        lang = lang === 'en' ? 'zh' : 'en';
        const t = i18n[lang];
        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('txt-select-reagent').innerText = t.selectReagent;
        document.getElementById('opt-water').innerText = t.water;
        document.getElementById('opt-acid').innerText = t.acid;
        document.getElementById('txt-notebook').innerText = t.notebook;
        document.getElementById('th-metal').innerText = t.thMetal;
        document.getElementById('th-bubbles').innerText = t.thBub;
        document.getElementById('th-heat').innerText = t.thHeat;
        document.getElementById('th-pop').innerText = t.thPop;
        document.getElementById('txt-challenge').innerText = t.challenge;
        document.getElementById('txt-order').innerText = t.order;
        document.getElementById('txt-identity').innerText = t.identity;
        document.getElementById('btn-submit').innerText = t.submit;
        
        ['A', 'B', 'C'].forEach(id => {
            document.getElementById('btn-add-' + id).innerText = t.add;
        });

        const ids = ['idA', 'idB', 'idC'];
        ids.forEach(idTag => {
            const dropdown = document.getElementById(idTag);
            dropdown.options[1].text = t.ca;
            dropdown.options[2].text = t.mg;
            dropdown.options[3].text = t.cu;
        });

        clearStatus();
    }

    function randomizeMetals() {
        const metals = ["Calcium", "Magnesium", "Copper"];
        const shuffled = [...metals].sort(() => Math.random() - 0.5);
        metalMapping.A = shuffled[0];
        metalMapping.B = shuffled[1];
        metalMapping.C = shuffled[2];
        console.log("Teacher Info - Secret Identity:", metalMapping); 
    }

    function addMetal(id) {
        if (activeMetals[id]) return;
        activeMetals[id] = true;
        const reagent = document.getElementById('reagent').value;
        const identity = metalMapping[id];
        document.getElementById('m' + id).style.display = 'block';
        
        let config = { temp: 25, bubbles: 0 };
        if (reagent === 'water') {
            if (identity === "Calcium") config = { temp: 50, bubbles: 40 };
            if (identity === "Magnesium") config = { temp: 28, bubbles: 5 };
        } else {
            if (identity === "Calcium") config = { temp: 92, bubbles: 100 };
            if (identity === "Magnesium") config = { temp: 62, bubbles: 45 };
        }

        if (config.bubbles > 0) {
            const bDiv = document.getElementById('b' + id);
            bDiv.style.display = 'block';
            for (let i = 0; i < config.bubbles / 2; i++) {
                let div = document.createElement('div');
                div.className = 'bubble';
                div.style.width = div.style.height = (Math.random() * 6 + 4) + 'px';
                div.style.left = Math.random() * 55 + 'px';
                div.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
                bDiv.appendChild(div);
            }
        }
        document.getElementById('merc' + id).style.height = config.temp + '%';
        document.getElementById('temp' + id).innerText = config.temp + '¬∞C';
    }

    async function startPopTest() {
        for (let id of ['A', 'B', 'C']) {
            if (activeMetals[id]) {
                const identity = metalMapping[id];
                const splint = document.getElementById('splint' + id);
                splint.style.display = 'block';
                await new Promise(r => setTimeout(r, 100));
                splint.style.right = '10px';
                await new Promise(r => setTimeout(r, 600));

                if (identity === "Calcium" || identity === "Magnesium") {
                    document.getElementById('pop' + id).style.display = 'block';
                    document.getElementById('status').innerText = i18n[lang].popMsg;
                    setTimeout(() => document.getElementById('pop' + id).style.display = 'none', 800);
                }
                await new Promise(r => setTimeout(r, 500));
                splint.style.right = '-80px';
                setTimeout(() => splint.style.display = 'none', 500);
            }
        }
    }

    function clearStatus() {
        const s = document.getElementById('status');
        s.innerText = "";
        s.className = "";
    }

    function checkAnswers() {
        const s = document.getElementById('status');
        const r1 = document.getElementById('rank1').value;
        const r2 = document.getElementById('rank2').value;
        const r3 = document.getElementById('rank3').value;
        const sIdA = document.getElementById('idA').value;
        const sIdB = document.getElementById('idB').value;
        const sIdC = document.getElementById('idC').value;

        const reactivity = { "Calcium": 3, "Magnesium": 2, "Copper": 1 };
        const sortedKeys = ['A', 'B', 'C'].sort((x, y) => reactivity[metalMapping[y]] - reactivity[metalMapping[x]]);
        
        const isOrderCorrect = (r1 === sortedKeys[0] && r2 === sortedKeys[1] && r3 === sortedKeys[2]);
        const isIdentityCorrect = (sIdA === metalMapping.A && sIdB === metalMapping.B && sIdC === metalMapping.C);

        if (isOrderCorrect && isIdentityCorrect) {
            s.innerText = i18n[lang].correct;
            s.className = "status-correct";
        } else {
            s.innerText = i18n[lang].wrong;
            s.className = "status-wrong";
        }
    }

    function resetLab(fullReset) {
        activeMetals = { A: false, B: false, C: false };
        if (fullReset) randomizeMetals();

        document.querySelectorAll('.metal').forEach(m => m.style.display = 'none');
        document.querySelectorAll('.bubbles').forEach(b => { b.style.display = 'none'; b.innerHTML = ''; });
        document.querySelectorAll('.mercury').forEach(m => m.style.height = '25%');
        document.querySelectorAll('.temp-val').forEach(t => t.innerText = '25¬∞C');
        
        const isAcid = document.getElementById('reagent').value === 'acid';
        const liquids = document.querySelectorAll('.liquid');
        liquids.forEach(l => isAcid ? l.classList.add('acid') : l.classList.remove('acid'));
        
        if(fullReset) {
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            document.querySelectorAll('select:not(#reagent)').forEach(s => s.selectedIndex = 0);
        }
        clearStatus();
    }

    window.onload = () => {
        randomizeMetals();
        document.getElementById('status').innerText = i18n[lang].ready;
    };
</script>

</body>
</html>