<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Metals Reactivity Challenge</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --bg: #f4f7f6;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        .container { 
            width: 100%; 
            max-width: 1100px; 
            background: white; 
            padding: 15px; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
        }
        
        h1 { font-size: 1.5rem; color: var(--primary); text-align: center; margin-bottom: 20px; }

        .lang-switch { display: flex; justify-content: flex-end; width: 100%; margin-bottom: 10px; }

        /* å¯¦é©—å°æ ¸å¿ƒå„ªåŒ–ï¼šæ‰‹æ©Ÿä¸Šå…è¨±æ°´å¹³æ»¾å‹•æˆ–ç¸®å° */
        .lab-bench { 
            display: flex; 
            justify-content: space-around; 
            align-items: flex-end; 
            height: 320px; 
            margin: 20px 0; 
            border-bottom: 6px solid #7f8c8d; 
            overflow-x: auto; /* æ‰‹æ©Ÿä¸Šå¯æ»‘å‹• */
            padding-bottom: 10px;
        }

        .tube-unit { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            position: relative; 
            min-width: 100px; /* ç¢ºä¿æ‰‹æ©Ÿä¸Šè©¦ç®¡ä¸æœƒç¸®å¾—å¤ªçª„ */
            margin: 0 5px;
        }

        /* è©¦ç®¡å…ƒä»¶ç¸®å°ä¸€é»ä»¥é©æ‡‰æ‰‹æ©Ÿ */
        .test-tube { width: 50px; height: 160px; border: 3px solid #7f8c8d; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; position: relative; background: rgba(255,255,255,0.4); }
        .liquid { position: absolute; bottom: 0; width: 100%; height: 45%; background: rgba(52, 152, 219, 0.2); transition: 0.5s; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; }
        .acid { background: rgba(155, 89, 182, 0.2); }
        
        .thermometer { width: 10px; height: 120px; background: #ddd; border-radius: 5px; position: relative; border: 1.5px solid #95a5a6; margin-right: 8px; }
        .mercury { width: 100%; background: var(--accent); position: absolute; bottom: 0; height: 25%; transition: height 1.5s; border-radius: 5px; }
        .temp-val { font-size: 12px; position: absolute; top: -20px; width: 40px; text-align: center; font-weight: bold; }

        .splint { position: absolute; top: -20px; right: -50px; width: 60px; height: 4px; background: #8B4513; transform: rotate(-30deg); display: none; z-index: 10; }
        .flame { position: absolute; left: -8px; top: -8px; width: 12px; height: 12px; background: #ff9d00; border-radius: 50% 50% 20% 50%; transform: rotate(-45deg); box-shadow: 0 0 5px red; }
        
        /* ç´€éŒ„è¡¨æ‰‹æ©ŸåŒ–ï¼šå…è¨±æ©«å‘æ²å‹• */
        .notebook { margin-top: 20px; overflow-x: auto; background: #fffde7; padding: 10px; border-radius: 10px; border: 1px solid #ffe082; }
        table { width: 100%; min-width: 400px; border-collapse: collapse; font-size: 14px; }
        th, td { border: 1px solid #d7ccc8; padding: 8px; text-align: center; }

        /* æŒ‘æˆ°å€æ‰‹æ©ŸåŒ–ï¼šç”±æ©«è®Šç›´ */
        .challenge-zone { margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 15px; }
        .selection-grid { display: flex; flex-direction: column; gap: 15px; } /* æ‰‹æ©Ÿç‰ˆæ”¹ç‚ºå‚ç›´ */
        .box { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: left; }

        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; -webkit-tap-highlight-color: transparent; }
        .btn-add { background: var(--primary); color: white; width: 100%; margin-top: 8px; font-size: 14px; }
        .btn-test { background: #e67e22; color: white; width: 100%; margin-top: 15px; font-size: 1.1em; padding: 15px; }
        .btn-submit { background: #2e7d32; color: white; margin-top: 20px; width: 100%; padding: 15px; }

        #status { margin-top: 15px; padding: 10px; font-size: 14px; font-weight: bold; text-align: center; border-radius: 8px; min-height: 40px; display: flex; align-items: center; justify-content: center; }
        .status-wrong { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .status-correct { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }

        /* é‡å°è¼ƒå¤§è¢å¹•ï¼ˆå¦‚ iPad, PCï¼‰æ¢å¾©æ©«å‘ä½ˆå±€ */
        @media (min-width: 600px) {
            h1 { font-size: 2rem; }
            .selection-grid { flex-direction: row; }
            .box { flex: 1; }
            .btn-submit { width: auto; padding: 15px 60px; }
            .tube-unit { min-width: 150px; }
            .test-tube { width: 65px; height: 200px; }
            .thermometer { width: 12px; height: 150px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-switch">
        <button class="btn" onclick="toggleLang()" style="background:#fff; border:1px solid #ccc; font-size: 12px;">English / ä¸­æ–‡</button>
    </div>

    <h1 id="txt-title">Metals Reactivity Challenge</h1>

    <div style="text-align: center; margin-bottom: 15px;">
        <strong id="txt-select-reagent" style="font-size: 14px;">Select Reagent:</strong><br>
        <select id="reagent" onchange="resetLab(false)" style="padding: 8px; margin-top: 5px; width: 80%; max-width: 300px;">
            <option value="water" id="opt-water">Distilled Water (H2O)</option>
            <option value="acid" id="opt-acid">Dilute HCl</option>
        </select><br>
        <button class="btn" style="background:#bdc3c7; margin-top:10px; font-size: 12px;" onclick="resetLab(true)" id="btn-restart">ğŸ”„ Restart (Randomize)</button>
    </div>

    <div class="lab-bench">
        <script>
            ['A', 'B', 'C'].forEach(id => {
                document.write(`
                    <div class="tube-unit">
                        <div id="pop${id}" style="position:absolute; top:-40px; font-size:12px; font-weight:bold; color:orange; display:none;">POP!</div>
                        <div id="splint${id}" class="splint"><div class="flame"></div></div>
                        <div class="temp-val" id="temp${id}">25Â°C</div>
                        <div style="display: flex; align-items: flex-end;">
                            <div class="thermometer"><div class="mercury" id="merc${id}"></div></div>
                            <div class="test-tube">
                                <div class="liquid" id="liq${id}"></div>
                                <div class="metal" id="m${id}" style="width:18px; height:18px; left:16px;"></div>
                                <div class="bubbles" id="b${id}" style="position:absolute; bottom:10px; width:100%; height:100px; display:none;"></div>
                            </div>
                        </div>
                        <strong style="margin-top:10px; font-size:12px;">Unknown ${id}</strong>
                        <button class="btn btn-add" onclick="addMetal('${id}')" id="btn-add-${id}">Add</button>
                    </div>
                `);
            });
        </script>
    </div>

    <button class="btn btn-test" onclick="startPopTest()" id="btn-pop">ğŸ”¥ Test for Gas (Pop Test)</button>

    <div class="notebook">
        <h3 id="txt-notebook" style="font-size: 1rem; margin-top:0;">ğŸ“” Observation Table</h3>
        <table>
            <thead>
                <tr>
                    <th id="th-metal">Metal</th>
                    <th id="th-bubbles">Bubbling?</th>
                    <th id="th-heat">Heat?</th>
                    <th id="th-pop">Pop?</th>
                </tr>
            </thead>
            <tbody>
                <script>
                    ['A', 'B', 'C'].forEach(id => {
                        document.write(`
                            <tr>
                                <td>${id}</td>
                                <td><input type="radio" name="bub${id}"></td>
                                <td><input type="radio" name="heat${id}"></td>
                                <td><input type="radio" name="popTest${id}"></td>
                            </tr>
                        `);
                    });
                </script>
            </tbody>
        </table>
    </div>

    <div class="challenge-zone">
        <h3 id="txt-challenge" style="font-size: 1.1rem; margin-top:0;">ğŸ† Final Conclusion</h3>
        <div class="selection-grid">
            <div class="box">
                <p id="txt-order" style="margin-top:0; font-weight:bold;">Reactivity Order (1=Highest):</p>
                1: <select id="rank1" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select>
                2: <select id="rank2" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select>
                3: <select id="rank3" onchange="clearStatus()"><option>?</option><option>A</option><option>B</option><option>C</option></select>
            </div>
            <div class="box">
                <p id="txt-identity" style="margin-top:0; font-weight:bold;">Identify the Metals:</p>
                A: <select id="idA" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select><br>
                B: <select id="idB" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select><br>
                C: <select id="idC" onchange="clearStatus()"><option>?</option><option value="Calcium">Calcium</option><option value="Magnesium">Magnesium</option><option value="Copper">Copper</option></select>
            </div>
        </div>
        <button class="btn btn-submit" onclick="checkAnswers()" id="btn-submit">Submit Result</button>
    </div>
    
    <div id="status"></div>
</div>

<script>
    let lang = 'en'; 
    let metalMapping = { A: "", B: "", C: "" };
    let activeMetals = { A: false, B: false, C: false };

    const i18n = {
        en: {
            title: "Metals Reactivity Challenge",
            selectReagent: "Select Reagent:",
            water: "Distilled Water (H2O)",
            acid: "Dilute HCl",
            notebook: "ğŸ“” Observation Table",
            thMetal: "Metal", thBub: "Bubbling?", thHeat: "Heat?", thPop: "Pop?",
            add: "Add",
            challenge: "ğŸ† Final Conclusion",
            order: "Reactivity Order (1=Highest):",
            identity: "Identify the Metals:",
            submit: "Submit Result",
            popMsg: "*POP!* Gas detected!",
            wrong: "âŒ Incorrect! Check again.",
            correct: "âœ… Congratulations! Correct!",
            ready: "Add metals to start.",
            ca: "Calcium", mg: "Magnesium", cu: "Copper"
        },
        zh: {
            title: "é‡‘å±¬åæ‡‰æ€§æŒ‘æˆ°",
            selectReagent: "é¸æ“‡è©¦åŠ‘ï¼š",
            water: "è’¸é¤¾æ°´ (H2O)",
            acid: "ç¨€é‡‹é¹½é…¸ (HCl)",
            notebook: "ğŸ“” è§€å¯Ÿç´€éŒ„è¡¨",
            thMetal: "é‡‘å±¬", thBub: "æ°£æ³¡?", thHeat: "ç†±é‡?", thPop: "çˆ†é³´?",
            add: "åŠ å…¥",
            challenge: "ğŸ† æœ€çµ‚åˆ¤æ–·",
            order: "åæ‡‰æ€§é †åº (1æœ€å¼·)ï¼š",
            identity: "è­˜åˆ¥èº«ä»½ï¼š",
            submit: "æäº¤çµæœ",
            popMsg: "*POP!* æª¢æ¸¬åˆ°æ°«æ°£ï¼",
            wrong: "âŒ ç­”æ¡ˆéŒ¯èª¤ï¼è«‹å†è§€å¯Ÿã€‚",
            correct: "âœ… æ­å–œï¼å…¨å°ï¼",
            ready: "è«‹åŠ å…¥é‡‘å±¬é–‹å§‹è§€å¯Ÿã€‚",
            ca: "éˆ£ (Calcium)", mg: "é‚ (Magnesium)", cu: "éŠ… (Copper)"
        }
    };

    function toggleLang() {
        lang = lang === 'en' ? 'zh' : 'en';
        const t = i18n[lang];
        document.getElementById('txt-title').innerText = t.title;
        document.getElementById('txt-select-reagent').innerText = t.selectReagent;
        document.getElementById('opt-water').innerText = t.water;
        document.getElementById('opt-acid').innerText = t.acid;
        document.getElementById('txt-notebook').innerText = t.notebook;
        document.getElementById('th-metal').innerText = t.thMetal;
        document.getElementById('th-bubbles').innerText = t.thBub;
        document.getElementById('th-heat').innerText = t.thHeat;
        document.getElementById('th-pop').innerText = t.thPop;
        document.getElementById('txt-challenge').innerText = t.challenge;
        document.getElementById('txt-order').innerText = t.order;
        document.getElementById('txt-identity').innerText = t.identity;
        document.getElementById('btn-submit').innerText = t.submit;
        ['A', 'B', 'C'].forEach(id => { document.getElementById('btn-add-' + id).innerText = t.add; });
        const ids = ['idA', 'idB', 'idC'];
        ids.forEach(idTag => {
            const dropdown = document.getElementById(idTag);
            dropdown.options[1].text = t.ca;
            dropdown.options[2].text = t.mg;
            dropdown.options[3].text = t.cu;
        });
        clearStatus();
    }

    function randomizeMetals() {
        const metals = ["Calcium", "Magnesium", "Copper"];
        const shuffled = [...metals].sort(() => Math.random() - 0.5);
        metalMapping.A = shuffled[0];
        metalMapping.B = shuffled[1];
        metalMapping.C = shuffled[2];
    }

    function addMetal(id) {
        if (activeMetals[id]) return;
        activeMetals[id] = true;
        const reagent = document.getElementById('reagent').value;
        const identity = metalMapping[id];
        const mDot = document.getElementById('m' + id);
        mDot.style.display = 'block';
        mDot.style.background = identity === "Copper" ? "#d35400" : "#7f8c8d";
        
        let config = { temp: 25, bubbles: 0 };
        if (reagent === 'water') {
            if (identity === "Calcium") config = { temp: 50, bubbles: 30 };
            if (identity === "Magnesium") config = { temp: 27, bubbles: 4 };
        } else {
            if (identity === "Calcium") config = { temp: 90, bubbles: 80 };
            if (identity === "Magnesium") config = { temp: 60, bubbles: 40 };
        }

        if (config.bubbles > 0) {
            const bDiv = document.getElementById('b' + id);
            bDiv.style.display = 'block';
            for (let i = 0; i < config.bubbles / 2; i++) {
                let div = document.createElement('div');
                div.className = 'bubble';
                div.style = `position:absolute; background:white; border-radius:50%; opacity:0.6; width:${Math.random()*5+2}px; height:${Math.random()*5+2}px; left:${Math.random()*40}px; animation: rise ${Math.random()*1+0.5}s linear infinite;`;
                bDiv.appendChild(div);
            }
        }
        document.getElementById('merc' + id).style.height = config.temp + '%';
        document.getElementById('temp' + id).innerText = config.temp + 'Â°C';
    }

    async function startPopTest() {
        for (let id of ['A', 'B', 'C']) {
            if (activeMetals[id]) {
                const identity = metalMapping[id];
                const splint = document.getElementById('splint' + id);
                splint.style.display = 'block';
                await new Promise(r => setTimeout(r, 100));
                splint.style.right = '5px';
                await new Promise(r => setTimeout(r, 600));
                if (identity === "Calcium" || identity === "Magnesium") {
                    document.getElementById('pop' + id).style.display = 'block';
                    document.getElementById('status').innerText = i18n[lang].popMsg;
                    setTimeout(() => document.getElementById('pop' + id).style.display = 'none', 800);
                }
                await new Promise(r => setTimeout(r, 500));
                splint.style.right = '-50px';
                setTimeout(() => splint.style.display = 'none', 500);
            }
        }
    }

    function clearStatus() { const s = document.getElementById('status'); s.innerText = ""; s.className = ""; }

    function checkAnswers() {
        const s = document.getElementById('status');
        const r = [document.getElementById('rank1').value, document.getElementById('rank2').value, document.getElementById('rank3').value];
        const ids = [document.getElementById('idA').value, document.getElementById('idB').value, document.getElementById('idC').value];
        const reactivity = { "Calcium": 3, "Magnesium": 2, "Copper": 1 };
        const sorted = ['A', 'B', 'C'].sort((x, y) => reactivity[metalMapping[y]] - reactivity[metalMapping[x]]);
        if (r[0]===sorted[0] && r[1]===sorted[1] && r[2]===sorted[2] && ids[0]===metalMapping.A && ids[1]===metalMapping.B && ids[2]===metalMapping.C) {
            s.innerText = i18n[lang].correct; s.className = "status-correct";
        } else {
            s.innerText = i18n[lang].wrong; s.className = "status-wrong";
        }
    }

    function resetLab(fullReset) {
        activeMetals = { A: false, B: false, C: false };
        if (fullReset) randomizeMetals();
        document.querySelectorAll('.metal').forEach(m => m.style.display = 'none');
        document.querySelectorAll('.bubbles').forEach(b => { b.style.display = 'none'; b.innerHTML = ''; });
        document.querySelectorAll('.mercury').forEach(m => m.style.height = '25%');
        document.querySelectorAll('.temp-val').forEach(t => t.innerText = '25Â°C');
        const isAcid = document.getElementById('reagent').value === 'acid';
        document.querySelectorAll('.liquid').forEach(l => isAcid ? l.classList.add('acid') : l.classList.remove('acid'));
        if(fullReset) { document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false); document.querySelectorAll('select:not(#reagent)').forEach(s => s.selectedIndex = 0); }
        clearStatus();
    }

    window.onload = () => { randomizeMetals(); document.getElementById('status').innerText = i18n[lang].ready; };
</script>
<style>
@keyframes rise { from { bottom: 0; } to { bottom: 100%; opacity: 0; } }
</style>
</body>
</html>
